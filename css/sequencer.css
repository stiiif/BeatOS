/* Sequencer Grid Styling */

/* Common Grid Definition for BOTH Header and Rows to ensure perfect alignment */
.sequencer-grid {
    display: grid;
    /* TRK | Dynamic Steps | RND | ACTIONS | VIS */
    /* Remove fixed min-width (20px) and use minmax(0, 1fr) to allow steps to shrink */
    /* Updated default to 64 to match configuration */
    /* Added final 30px column for visualizer */
    grid-template-columns: 40px repeat(var(--num-steps, 64), minmax(0, 1fr)) 25px 125px 30px;
    gap: 1px;
    width: 100%;
    padding-left: 4px;
    padding-right: 4px;
}

.matrix-container {
    display: flex;
    flex-direction: column;
    gap: 1px;
    padding-bottom: 20px;
    width: 100%;
}

/* Divider for every 4th step (Beat Markers - Default 4/4) */
.beat-divider {
    border-right: 1px solid #444 !important;
    margin-right: 1px; 
}

/* Divider for every 16th step (Bar Markers) */
.bar-divider {
    border-right: 2px solid #737373 !important; /* neutral-500 approx */
    margin-right: 1px;
}

/* NEW: Divider for 12/8 Time Signature (Triplets) */
/* Applied dynamically by UIManager when a 12/8 pattern is loaded */
.triplet-divider {
    border-right: 1px solid #d946ef !important; /* Fuchsia-500 for visibility */
    margin-right: 1px;
}

/* Header Cells */
.header-cell {
    font-size: 10px;
    color: #525252;
    display: flex;
    align-items: end;
    justify-content: center;
    padding-bottom: 2px;
    /* Prevent text overflow breaking layout in small cells */
    overflow: hidden; 
}

/* Track Label */
.track-label {
    font-size: 0.6rem;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #171717;
    color: #666;
    cursor: pointer;
    border-radius: 1px;
    transition: all 0.2s;
    position: sticky;
    left: 0;
    z-index: 10; /* Keep track number visible when scrolling */
}
.track-label:hover { background: #262626; color: #fff; }
.track-label.selected {
    background: #064e3b;
    color: #34d399;
    border-left: 2px solid #10b981;
}

/* Steps */
.step-btn {
    height: 16px;
    background: #171717;
    border: 1px solid #222;
    border-radius: 1px;
    cursor: pointer;
    transition: background 0.1s, transform 0.1s, opacity 0.1s; /* Added transform/opacity transition */
    min-width: 0; 
}
.step-btn:hover { border-color: #444; }

/* Velocity Styles */
.step-btn.vel-1 { 
    background: var(--step-group-color, #10b981);
    border-color: var(--step-group-color, #10b981);
    opacity: 0.35; 
    transform: scale(0.8); 
    box-shadow: none;
}
.step-btn.vel-2 { 
    background: var(--step-group-color, #10b981);
    border-color: var(--step-group-color, #10b981);
    opacity: 0.75; 
    box-shadow: 0 0 2px var(--step-group-color-glow, rgba(16, 185, 129, 0.4));
}
.step-btn.vel-3 { 
    background: var(--step-group-color, #10b981);
    border-color: #fff; /* Brighter border for accent */
    opacity: 1.0; 
    box-shadow: 0 0 6px var(--step-group-color-glow, rgba(16, 185, 129, 0.8));
}

/* Active class for backward compatibility or general active state */
.step-btn.active {
    background: var(--step-group-color, #10b981);
    border-color: var(--step-group-color, #10b981);
    box-shadow: 0 0 4px var(--step-group-color-glow, rgba(16, 185, 129, 0.4));
}

.step-btn.step-dimmed {
    opacity: 0.3;
    box-shadow: none !important;
}

/* Automation Levels (Indigo/Purple Palette) */
.auto-level-1 { background-color: #818cf8 !important; border-color: #c7d2fe !important; opacity: 0.4; } 
.auto-level-2 { background-color: #6366f1 !important; border-color: #a5b4fc !important; opacity: 0.55; }
.auto-level-3 { background-color: #4f46e5 !important; border-color: #818cf8 !important; opacity: 0.7; }
.auto-level-4 { background-color: #4338ca !important; border-color: #6366f1 !important; opacity: 0.85; }
.auto-level-5 { background-color: #312e81 !important; border-color: #4f46e5 !important; opacity: 1.0; }

/* Choke Group Colors */
.track-group-0 .track-label { border-right: 2px solid #3b82f6; }
.track-group-1 .track-label { border-right: 2px solid #8b5cf6; }
.track-group-2 .track-label { border-right: 2px solid #ec4899; }
.track-group-3 .track-label { border-right: 2px solid #ef4444; }
.track-group-4 .track-label { border-right: 2px solid #f97316; }
.track-group-5 .track-label { border-right: 2px solid #eab308; }
.track-group-6 .track-label { border-right: 2px solid #84cc16; }
.track-group-7 .track-label { border-right: 2px solid #14b8a6; }

.step-playing {
    border-color: #666 !important;     /* Grey border instead of white */
    background-color: #333; /* Slightly lighter background */
}
/* Ensure step playing visibility on velocity steps */
.step-btn.vel-1.step-playing, .step-btn.vel-2.step-playing, .step-btn.vel-3.step-playing {
    background-color: #34d399; 
    border-color: #fff;
    filter: brightness(1.2);
}

.track-rnd-btn {
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #171717;
    color: #444;
    border-radius: 1px;
    cursor: pointer;
    font-size: 0.5rem;
    transition: all 0.2s;
}
.track-rnd-btn:hover { background: #262626; color: #10b981; }

.track-actions { 
    height: 16px; display: flex; gap: 1px; background: #000;
    /* Keep actions visible when scrolling */
    position: sticky;
    right: 30px; /* Offset by VIS column width (30px) */
    z-index: 10; 
}
.action-btn {
    flex: 1; font-size: 0.45rem; display: flex; align-items: center; justify-content: center;
    background: #1a1a1a; color: #555; cursor: pointer; border: none; padding: 0; transition: all 0.1s;
    min-width: 0;
}
.action-btn:hover { color: #fff; background: #333; }
.action-btn.mute-active { color: #ef4444; background: #450a0a; }
.action-btn.solo-active { color: #eab308; background: #422006; }
.action-btn.lock-active { color: #06b6d4; background: #164e63; }
.action-btn.exclude-active { color: #f472b6; background: #831843; }
.action-btn.erase:hover { color: #ef4444; }

.track-vis-canvas {
    height: 16px;
    width: 100%;
    background: #000;
    border-left: 1px solid #222;
    position: sticky;
    right: 0;
    z-index: 10;
}

.row-muted .step-btn { opacity: 0.3; }
.row-muted .track-label { opacity: 0.5; }